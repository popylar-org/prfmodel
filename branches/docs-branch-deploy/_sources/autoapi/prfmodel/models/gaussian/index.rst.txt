prfmodel.models.gaussian
========================

.. py:module:: prfmodel.models.gaussian

.. autoapi-nested-parse::

   Gaussian response models.



Exceptions
----------

.. autoapisummary::

   prfmodel.models.gaussian.GridMuDimensionsError


Classes
-------

.. autoapisummary::

   prfmodel.models.gaussian.Gaussian2DPRFResponse
   prfmodel.models.gaussian.GaussianCFResponse
   prfmodel.models.gaussian.Gaussian2DPRFModel
   prfmodel.models.gaussian.GaussianCFModel


Functions
---------

.. autoapisummary::

   prfmodel.models.gaussian.predict_gaussian_response


Module Contents
---------------

.. py:exception:: GridMuDimensionsError(grid_shape: tuple[int, Ellipsis], mu_shape: tuple[int, Ellipsis])



   Exception raised when the dimensions of the stimulus grid and the Gaussian mu parameter do not match.

   For a stimulus grid with shape (..., m), the shape of the Gaussian mu parameter must be (num_batches, m).

   :param grid_shape: Shape of the stimulus grid.
   :type grid_shape: tuple of int
   :param mu_shape: Shape of the Gaussian mu parameter.
   :type mu_shape: tuple of int


.. py:function:: predict_gaussian_response(grid: prfmodel.typing.Tensor, mu: prfmodel.typing.Tensor, sigma: prfmodel.typing.Tensor) -> prfmodel.typing.Tensor

   Predict a isotropic Gaussian population receptive field response.

   The dimensionality of the Gaussian depends on the number of dimensions of `grid` and `mu`. All dimensions have
   the same size `sigma`.

   :param grid: Stimulus grid for which to make predictions.
   :type grid: Tensor
   :param mu: Centroid of the population receptive field. Must have at least two dimensions.
              The first dimension corresponds to the number of batches.
              The second dimension corresponds to the number of grid dimensions and must match the size of the
              last `grid` dimension.
   :type mu: Tensor
   :param sigma: Size of the population receptive field. Must have at least two dimensions.
                 The first dimension corresponds to the number of batches,
                 and its size must match the size of the first `mu` dimension.
                 The second dimension must have size one (because all Gaussian dimensions have the same size).
   :type sigma: Tensor

   :returns: The predicted Gaussian population receptive field response with shape (num_batches, ...)
             where `...` corresponds to the dimensions of the Gaussian.
   :rtype: Tensor

   :raises BatchDimensionError: If `mu` and `sigma` have batch (first) dimensions with different sizes.
   :raises GridDimensionsError: If the grid has mismatching dimensions.
   :raises GridMuDimensionsError: If the grid and mu dimensions do not match.
   :raises ParameterShapeError: If `mu` or `sigma` have less than two dimensions.

   .. rubric:: Examples

   Predict a 2D Gaussian response:

   >>> import numpy as np
   >>> # Define a 2D grid
   >>> num_x, num_y = 10, 10
   >>> x = np.linspace(-3, 3, num_x)
   >>> y = np.linspace(-4, 4, num_y)
   >>> xv, yv = np.meshgrid(x, y)
   >>> grid = np.stack((xv, yv), axis=-1)  # shape (10, 10, 2)
   >>> # Define 2D centroids of Gaussian for 3 batches
   >>> mu = np.array([ # shape (3, 2), first column y, second column x
   >>>     [0.0, 1.0],
   >>>     [1.0, 0.0],
   >>>     [0.0, 0.0],
   >>> ])
   >>> # Define size of Gaussian for 3 batches
   >>> sigma = np.array([[1.0], [1.5], [2.0]]) # shape (3, 1)
   >>> resp = predict_gaussian_response(grid, mu, sigma)
   >>> print(resp.shape) # (num_batches, num_y, num_x)
   (3, 10, 10)


.. py:class:: Gaussian2DPRFResponse



   Two-dimensional isotropic Gaussian population receptive field response model.

   Predicts a response to a stimulus grid.
   The model has three parameters: `mu_y` and `mu_x` for the center and `sigma` for the width of the Gaussian.

   .. rubric:: Examples

   >>> import numpy as np
   >>> import pandas as pd
   >>> import prfmodel as pm
   >>> # Define a 2D grid
   >>> num_x, num_y = 20, 10
   >>> x = np.linspace(-3, 3, num_x)
   >>> y = np.linspace(-4, 4, num_y)
   >>> xv, yv = np.meshgrid(x, y)
   >>> grid = np.stack((xv, yv), axis=-1)  # shape (20, 10, 2)
   >>> # Define 2D centroids of Gaussian for 3 voxels
   >>> params = pd.DataFrame({
   >>>     "mu_x": [0.0, 1.0, 0.0],
   >>>     "mu_y": [1.0, 0.0, 0.0],
   >>>     "sigma": [1.0, 1.5, 2.0],
   >>> })
   >>> # Define dummy design for 10 frames
   >>> design = np.ones(10, num_y, num_x)
   >>> # Create stimulus object
   >>> stimulus = pm.Stimulus(
   >>>     design=design,
   >>>     grid=grid,
   >>>     dimension_labels=("y", "x"),
   >>> )
   >>> # Create model instance
   >>> model = Gaussian2DResponse()
   >>> # Predict response to stimulus grid
   >>> resp = model(stimulus, params)
   >>> print(resp.shape) # (num_voxels, num_y, num_x)
   (3, 20, 10)


   .. py:property:: parameter_names
      :type: list[str]


      `mu_y`, `mu_x`, `sigma`.

      :type: Names of parameters used by the model


   .. py:method:: __call__(stimulus: prfmodel.stimuli.prf.PRFStimulus, parameters: pandas.DataFrame, dtype: str | None = None) -> prfmodel.typing.Tensor

      Predict the model response for a stimulus with a 2D grid.

      :param stimulus: Stimulus object with a 2D stimulus grid.
      :type stimulus: Stimulus
      :param parameters: Dataframe with columns containing different model parameters and rows containing parameter values
                         for different voxels. Must contain the columns `mu_y`, `mu_x` and `sigma`.
      :type parameters: pandas.DataFrame
      :param dtype: The dtype of the prediction result. If `None` (the default), uses the dtype from
                    :func:`prfmodel.utils.get_dtype`.
      :type dtype: str, optional

      :returns: Model predictions of shape `(num_voxels, size_y, size_x)` and dtype `dtype`.
                `num_voxels` is the number of rows in `parameters` and `size_y` and `size_x` are the sizes of the
                x and y stimulus grid dimension.
      :rtype: Tensor



.. py:class:: GaussianCFResponse



   Gaussian connective field response model.

   Predicts a response to a stimulus distance matrix.
   The model has two parameters: `center_index` is the index of the row in the stimulus distance matrix that is the
   center of the Gaussian; `sigma` for the width of the Gaussian.



   .. py:property:: parameter_names
      :type: list[str]


      `center_index`, `sigma`.

      :type: Names of parameters used by the model


   .. py:method:: __call__(stimulus: prfmodel.stimuli.cf.CFStimulus, parameters: pandas.DataFrame, dtype: str | None = None) -> prfmodel.typing.Tensor

      Predict the model response for a stimulus with a distance matrix.

      :param stimulus: Connective field stimulus object with a distance matrix.
      :type stimulus: CFStimulus
      :param parameters: Dataframe with columns containing different model parameters and rows containing parameter values
                         for different voxels. Must contain the columns `center_index` and `sigma`.
      :type parameters: pandas.DataFrame
      :param dtype: The dtype of the prediction result. If `None` (the default), uses the dtype from
                    :func:`prfmodel.utils.get_dtype`.
      :type dtype: str, optional

      :returns: Model predictions of shape `(num_voxels, num_rows)` and dtype `dtype`.
                `num_voxels` is the number of rows in `parameters` and `num_rows` is the number of rows in the stimulus
                distance matrix.
      :rtype: Tensor



.. py:class:: Gaussian2DPRFModel(impulse_model: prfmodel.models.base.BaseImpulse | type[prfmodel.models.base.BaseImpulse] | None = DerivativeTwoGammaImpulse, temporal_model: prfmodel.models.base.BaseTemporal | type[prfmodel.models.base.BaseTemporal] | None = BaselineAmplitude)



   Two-dimensional isotropic Gaussian population receptive field model.

   This is a generic class that combines a 2D isotropic Gaussian population receptive field, impulse,
   and temporal model response.

   :param impulse_model: An impulse response model class or instance. Reponse model classes will be instantiated during object
                         initialization. The default creates a :class:`~prfmodel.models.impulse.ShiftedDerivativeGammaImpulse`
                         instance with default values.
   :type impulse_model: BaseImpulse or type or None, default=ShiftedDerivativeGammaImpulse, optional
   :param temporal_model: A temporal model class or instance. Temporal model instances will be instantiated during initialization.
                          The default creates a `BaselineAmplitude` instance.
   :type temporal_model: BaseTemporal or type or None, default=BaselineAmplitude, optional

   .. rubric:: Notes

   The simple composite model follows five steps:

   1. The 2D Gaussian population receptive field response model makes a prediction for the stimulus grid.
   2. The response is encoded with the stimulus design.
   3. A impulse response model generates an impulse response.
   4. The encoded response is convolved with the impulse response.
   5. The temporal model modifies the convolved response.


   .. py:method:: __call__(stimulus: prfmodel.stimuli.prf.PRFStimulus, parameters: pandas.DataFrame, dtype: str | None = None) -> prfmodel.typing.Tensor

      Predict a simple population receptive field model response to a stimulus.

      :param stimulus: Population receptive field stimulus object.
      :type stimulus: PRFStimulus
      :param parameters: Dataframe with columns containing different (sub-) model parameters and rows containing parameter values
                         for different voxels.
      :type parameters: pandas.DataFrame
      :param dtype: The dtype of the prediction result. If `None` (the default), uses the dtype from
                    :func:`prfmodel.utils.get_dtype`.
      :type dtype: str, optional

      :returns: Model predictions of shape (num_voxels, num_frames) and dtype `dtype`. The number of voxels is the
                number of rows in `parameters`. The number of frames is the number of frames in the stimulus design.
      :rtype: Tensor



   .. py:property:: parameter_names
      :type: list[str]


      A list with names of unique parameters that are used by the submodels.


.. py:class:: GaussianCFModel(temporal_model: prfmodel.models.base.BaseTemporal | type[prfmodel.models.base.BaseTemporal] | None = BaselineAmplitude)



   Gaussian connective field model.

   This is a generic class that combines a Gaussian connective field and temporal model response.

   :param temporal_model: A temporal model class or instance. Temporal model instances will be instantiated during initialization.
                          The default creates a `BaselineAmplitude` instance.
   :type temporal_model: BaseTemporal or type or None, default=BaselineAmplitude, optional

   .. rubric:: Notes

   The simple composite model follows three steps:

   1. The Gaussian connective field response model makes a prediction for the stimulus distance matrix.
   2. The connective field response is encoded with the source response.
   3. The temporal model modifies the encoded response.


   .. py:method:: __call__(stimulus: prfmodel.stimuli.cf.CFStimulus, parameters: pandas.DataFrame, dtype: str | None = None) -> prfmodel.typing.Tensor

      Predict a simple connective field model response to a stimulus.

      :param stimulus: Connective field stimulus object.
      :type stimulus: CFStimulus
      :param parameters: Dataframe with columns containing different (sub-) model parameters and rows containing parameter values
                         for different voxels.
      :type parameters: pandas.DataFrame
      :param dtype: The dtype of the prediction result. If `None` (the default), uses the dtype from
                    :func:`prfmodel.utils.get_dtype`.
      :type dtype: str, optional

      :returns: Model predictions of shape (num_voxels, num_frames) and dtype `dtype`. The number of voxels is the
                number of rows in `parameters`. The number of frames is the number of frames in the stimulus source
                response.
      :rtype: Tensor



   .. py:property:: parameter_names
      :type: list[str]


      A list with names of unique parameters that are used by the submodels.


